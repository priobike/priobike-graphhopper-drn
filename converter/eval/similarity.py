import json
from functools import partial

import pyproj
from shapely.geometry import Point, LineString
from shapely.ops import transform

routes = {
    "1_Ost_West": [[9.99085153989529, 53.56090651069028], [9.990566309692458, 53.56116265318303],
                   [9.990226749927187, 53.5614490468896], [9.990138464388214, 53.56151560289585],
                   [9.989707223486319, 53.561674933515728], [9.98911638949474, 53.56197140788199],
                   [9.98645763653264, 53.56332669280946], [9.986345581810097, 53.56339929613371],
                   [9.986277669857046, 53.56350416738206], [9.985989044056561, 53.563669540745447],
                   [9.985601945924149, 53.5638328967257], [9.98537104528376, 53.56390549918105],
                   [9.985085815080933, 53.56401036917438], [9.984980551553696, 53.56405877062208],
                   [9.98493301318656, 53.56407087097534], [9.984695321350863, 53.564066837524617],
                   [9.984494981089354, 53.56408902149875], [9.984148630128772, 53.56414347302224],
                   [9.984090904968677, 53.56409910511949], [9.983999223832053, 53.5640809546004],
                   [9.983567982930153, 53.564133389412059], [9.983157115614173, 53.5641596067935],
                   [9.982410084130568, 53.56417170711793], [9.982043359584072, 53.564169690397459],
                   [9.981357448858214, 53.56416364023535], [9.980732658890112, 53.564175740558649],
                   [9.98038630792953, 53.56419994119478], [9.97997544061355, 53.56420195791385],
                   [9.979225013532292, 53.564236242123069], [9.979055233649657, 53.5642402755576],
                   [9.978875266974061, 53.56432497759431], [9.978573058782964, 53.5643431280087],
                   [9.978573058782964, 53.5643431280087]],
    "1_West_Ost": [[9.978725860677337, 53.564123305799508], [9.979248782715864, 53.564109188737848],
                   [9.98055608781217, 53.56409910511952], [9.981873579701436, 53.564093054947338],
                   [9.982797182262982, 53.56408902149875], [9.983350664680377, 53.56406885425004],
                   [9.983941498671955, 53.564002302261048], [9.984457629515174, 53.563905499181078],
                   [9.984817562866362, 53.563792561974398], [9.985337089307232, 53.56358483739619],
                   [9.986352373005405, 53.56307258019321], [9.987218250406855, 53.56262485425019],
                   [9.987904161132711, 53.562267880170399], [9.988206369323806, 53.56211258542134],
                   [9.988362566815832, 53.56201779483976], [9.988654588213967, 53.56185846551132],
                   [9.988851532877828, 53.56178787637649], [9.989170719057182, 53.561628546181989],
                   [9.989398224099919, 53.5614893838756], [9.989608751154388, 53.56128366484491],
                   [9.989768344244068, 53.56117072063797]],
    "2_Ost_West": [[10.004045134575036, 53.547722154285327], [10.003046828865127, 53.54756277111613],
                   [10.00274631847286, 53.54754158723201], [10.002491648648905, 53.54753956971867],
                   [10.002192836055463, 53.54758597250087], [10.001780270940655, 53.547651541562888],
                   [10.001739523768821, 53.547684830432427], [10.001666518419288, 53.54770197923378],
                   [10.001573139483839, 53.54771206676074], [10.0010621020371, 53.54773526806364],
                   [10.000719146674174, 53.54775140809296], [10.0001028457002, 53.54777360062317],
                   [9.999795544112624, 53.54778671438557], [9.999705560774828, 53.547802854395239],
                   [9.999617275235856, 53.54782504689849], [9.999175847541, 53.54781798564871],
                   [9.998938155705308, 53.547812941898168], [9.998634249715386, 53.54777360062317],
                   [9.998362601903166, 53.54774333807905], [9.997393158773307, 53.54769895297522],
                   [9.997316757826122, 53.54768583918564], [9.997213192097713, 53.54766869037775],
                   [9.997053599008038, 53.54766263785565], [9.996707248047456, 53.547633383986667],
                   [9.996618962508484, 53.5476283402141], [9.996488231998855, 53.547646497792509],
                   [9.99619960619837, 53.547620270176739], [9.995413525341757, 53.54756680614048],
                   [9.994309956104616, 53.54748005303224], [9.99407905546423, 53.54745584283079],
                   [9.993527270845658, 53.54743062385617], [9.993296370205272, 53.54739229098601],
                   [9.993113007932019, 53.54738119462239], [9.992644415455944, 53.547354966842238],
                   [9.9922810865071, 53.54732974780751], [9.991880405984075, 53.54731461637948],
                   [9.99106546254742, 53.547286371032679], [9.990557820698335, 53.54727830093014],
                   [9.990160535772964, 53.547291414846], [9.989396526301097, 53.54736808073433],
                   [9.989264097992637, 53.54740237858679], [9.989208070631366, 53.547443737724837],
                   [9.989036592949905, 53.54746391289948], [9.988603654249179, 53.54750628073487],
                   [9.988343891028743, 53.54754158723201], [9.98814864416371, 53.54757487618803],
                   [9.98806884761887, 53.547602112587117], [9.988038287239997, 53.54762834021412],
                   [9.98784983157027, 53.547671716638458], [9.987693634078243, 53.54770601424487],
                   [9.987235228395122, 53.547781670631277], [9.98717071203972, 53.54779276688992],
                   [9.98710449788549, 53.54778974063786], [9.986904157623977, 53.54782504689853],
                   [9.986741168936647, 53.54788557184824], [9.986566295657532, 53.54792087802895],
                   [9.986382933384285, 53.547932982998407], [9.986111285572065, 53.54797333287161],
                   [9.985654577687768, 53.548055041247], [9.985309924526016, 53.548120609582337],
                   [9.985014507530228, 53.548179116626538], [9.98471399713796, 53.548247710989169],
                   [9.984182586105307, 53.5483627071712], [9.983741158410448, 53.54845147594012],
                   [9.983571378527813, 53.54849888645635], [9.983260681342588, 53.54855840171003],
                   [9.98302468730572, 53.548621951803777], [9.982428759917664, 53.54874098188132],
                   [9.98140498722536, 53.54895886657975], [9.980975444122287, 53.549034520726539],
                   [9.980719076499505, 53.549079913149707], [9.980236901632815, 53.54918683733187],
                   [9.979951671429984, 53.549244334186067], [9.979671534623633, 53.54931494425096],
                   [9.979345557248968, 53.54937344964411], [9.978880360370546, 53.54944607691617],
                   [9.978540800605272, 53.549496512448417], [9.978410070095642, 53.549504582128019],
                   [9.97802297196323, 53.54951971277307], [9.977593428860155, 53.54953484341272],
                   [9.977457604954042, 53.549550982755757], [9.977165583555909, 53.54954795662938],
                   [9.976812441400025, 53.54954694792057], [9.976377804900473, 53.54956006113348],
                   [9.976007684756324, 53.549588304962878], [9.975396477178832, 53.54963974903227],
                   [9.974815829980212, 53.54969119303916], [9.974542484369163, 53.54972851512263],
                   [9.974321770521735, 53.549754741431858], [9.97394995257876, 53.54982535064519],
                   [9.97384638685035, 53.54985157689445], [9.973783568293778, 53.54988183793105],
                   [9.97375810131138, 53.54991714244641], [9.97323008587638, 53.55003415148678],
                   [9.973017861023085, 53.55004524715484], [9.97288882831228, 53.55004423845786],
                   [9.972736026417908, 53.55004625585181], [9.972306483314832, 53.550134012394668],
                   [9.9721112364498, 53.55017839494472], [9.971739418506827, 53.550264133830129]],
    "2_West_Ost": [[9.971606990198368, 53.54990402934412], [9.972245362557083, 53.54977794161497],
                   [9.972533988357567, 53.54971540196188], [9.972710559435509, 53.54966597539655],
                   [9.972766586796777, 53.54960646170039], [9.972848081140447, 53.54951164309637],
                   [9.972917690892326, 53.549480373084637], [9.973226690278726, 53.549488442767287],
                   [9.973464382114419, 53.549488442767287], [9.97367830476654, 53.54948239050546],
                   [9.97389392521749, 53.54943901593683], [9.974123128059052, 53.54940673715926],
                   [9.974333655113523, 53.549378493208688], [9.974573044748036, 53.54937244093112],
                   [9.974853181554389, 53.549370423505049], [9.974992401058153, 53.549350249239278],
                   [9.975196136917316, 53.5493250313935], [9.976129926271824, 53.54927257822616],
                   [9.97710446279816, 53.54922920344252], [9.977386297403334, 53.54922113371044],
                   [9.97768341219795, 53.54922920344252], [9.977747928553353, 53.549231220875309],
                   [9.977946571016039, 53.549194907070518], [9.978148609076378, 53.54918381117948],
                   [9.978444026072165, 53.549154558361959], [9.978927898737683, 53.5491061398609],
                   [9.979360837438409, 53.549050660260359], [9.979623996256493, 53.54900526780581],
                   [9.979931297844069, 53.548954831688138], [9.98025897301756, 53.54889027336976],
                   [9.980454219882592, 53.548854967997709], [9.980554390013348, 53.54883176730867],
                   [9.980640977753494, 53.54880150552119], [9.981129943815489, 53.548699624010989],
                   [9.98122671834859, 53.548693571636338], [9.98148817936785, 53.548641117686347],
                   [9.98202298599816, 53.548533183392418], [9.982535721243725, 53.54842726629434],
                   [9.98307562127051, 53.54833446252383], [9.983135044229435, 53.548321348931178],
                   [9.983260681342582, 53.548285034345649], [9.983413483236959, 53.54825578090686],
                   [9.984386321964474, 53.54805806748009], [9.984681738960262, 53.54799350779377],
                   [9.985133353448076, 53.54787851060857], [9.985654577687768, 53.547745355582687],
                   [9.986007719843652, 53.547643471529998], [9.986101098779106, 53.54761522640264],
                   [9.986982256369993, 53.54749518440115], [9.98746103563903, 53.54742255378113],
                   [9.98822844070855, 53.54731058133109], [9.988544231290256, 53.54725913443041],
                   [9.988717406770548, 53.54720264364389], [9.989163927861882, 53.54714514401588],
                   [9.98935577912926, 53.54714010018514], [9.989839651794778, 53.547110845954978],
                   [9.990186002755369, 53.54707453033078], [9.990371062827439, 53.547082600472197],
                   [9.990688551207976, 53.54709470568141], [9.99090077606127, 53.54706948649162],
                   [9.991031506570899, 53.54705334620225], [9.991493307851674, 53.54707553909853],
                   [9.99220808115758, 53.54710479335309], [9.992352394057818, 53.54712295115612],
                   [9.992584992497033, 53.547143126483657], [9.99351708405271, 53.54715422290973],
                   [9.993844759226202, 53.547157249207227], [9.994948328463343, 53.54721676634758],
                   [9.99571743133169, 53.54726922206293], [9.99626412255378, 53.54731663390352],
                   [9.996464462815295, 53.54733882666176], [9.99675818201225, 53.54735698436437],
                   [9.997197911908286, 53.547395317266509], [9.997416927956886, 53.5474195275026],
                   [9.997517098087642, 53.547390273465577], [9.997598592431306, 53.54736808073436],
                   [9.997848168858785, 53.547390273465577], [9.99841353586797, 53.547426588818868],
                   [9.998834589976907, 53.54745079903709], [9.99935751201543, 53.5474740004832],
                   [9.99997551078823, 53.547470974208348], [10.00028960357111, 53.547457860348099],
                   [10.000483152637317, 53.547438693929709], [10.000916091338042, 53.54730150247083],
                   [10.001053613042977, 53.54728838855807], [10.001683496407562, 53.54726619577341],
                   [10.00194665522565, 53.54725509937675], [10.002192836055477, 53.547212731289857],
                   [10.002727642685782, 53.54713404758744], [10.002911004959032, 53.547136065120117],
                   [10.003408460015157, 53.54718246834471], [10.003817629532313, 53.54722080140492],
                   [10.004240381440083, 53.547262160720439]],
    "3_West_Ost": [[9.976351775004533, 53.552854487173508], [9.976770404783473, 53.55323413811407],
                   [9.97703158530927, 53.553466328749788], [9.977327960374004, 53.55370512063382],
                   [9.97766879169845, 53.55398462647291], [9.977961462074873, 53.55422121461827],
                   [9.97832637387333, 53.55451392184177], [9.97864868175623, 53.55477251488467],
                   [9.978878372431403, 53.55496838430779], [9.97907472091179, 53.5551235386567],
                   [9.9791395529572, 53.55517745741069], [9.979500760067344, 53.55537112420535],
                   [9.979565592112757, 53.555405235878478], [9.979847148424254, 53.55557139234479],
                   [9.979911980469668, 53.555616507564057], [9.980052758625416, 53.55572434374691],
                   [9.980432489177107, 53.55601263913106], [9.980612166560102, 53.55614908358985],
                   [9.98088075646252, 53.55632954171435], [9.981171574494793, 53.556482490375788],
                   [9.981699492578852, 53.55676968025344], [9.982038471559142, 53.55693253035246],
                   [9.982453396649773, 53.55711738646196], [9.982683087324942, 53.55721201487211],
                   [9.983136911642817, 53.557372662618707], [9.983494414064652, 53.55748929690182],
                   [9.983602776197696, 53.55752010590406], [9.983691688717118, 53.557533859915647],
                   [9.983725957083975, 53.55752945863241], [9.983989916126007, 53.55759327719444],
                   [9.984513203349677, 53.55771651276587], [9.984789202628712, 53.55778033104571],
                   [9.985035564401273, 53.557828194692429], [9.985283778517987, 53.55786450500896],
                   [9.985644985628133, 53.557894213426617], [9.986121964247939, 53.55793272430729],
                   [9.98653040613403, 53.55796463329618], [9.987254672698472, 53.55802294966199],
                   [9.987784443126686, 53.558064761346447], [9.988261421746494, 53.55810437237782],
                   [9.988511488207362, 53.55813298032187], [9.988628185889102, 53.55813022955886],
                   [9.988844910155189, 53.558102721918917], [9.989095902788139, 53.55806696196024],
                   [9.98925890907374, 53.55805100750743], [9.989290398924368, 53.55805100750743],
                   [9.989559914998863, 53.55800754534671], [9.989964652196639, 53.557952529889437],
                   [9.9903008526607, 53.557900815294328], [9.990530543335872, 53.55783094547509],
                   [9.990862112939542, 53.55778803324538], [9.991270554825628, 53.55773081687143],
                   [9.99165399006563, 53.55767690137135], [9.992231921441862, 53.55760097942818],
                   [9.992519960957902, 53.55755586632493], [9.992858013766118, 53.55747829368131],
                   [9.992852456733653, 53.557444183679489], [9.992962671210848, 53.5574084231642],
                   [9.993067328655587, 53.557379264567838], [9.993121972808144, 53.55735065611413],
                   [9.993207180639257, 53.557303342090538], [9.993277569717132, 53.557277484404149],
                   [9.993447985379353, 53.55732809943507], [9.993610991664957, 53.55735340692781],
                   [9.993857353437518, 53.55736441018083], [9.994140762093169, 53.55738091505497],
                   [9.994297285174234, 53.55738586651596], [9.9944047211352, 53.557382565542017],
                   [9.994542720774718, 53.55736275969306], [9.995003028297134, 53.55729729029301],
                   [9.995252168585927, 53.55725272702998], [9.995636529998006, 53.55718285614038],
                   [9.995914381621195, 53.55712838977633], [9.99631541413066, 53.557038712680739],
                   [9.99647749424419, 53.55700240165544], [9.996962808412692, 53.55688466569242],
                   [9.997392552256557, 53.55676582906107], [9.997718564827768, 53.556682203083379],
                   [9.997979745353565, 53.556609580389679], [9.9980556914639, 53.55655456311449],
                   [9.998283529794918, 53.55649074298567], [9.998731797080329, 53.556355399980137],
                   [9.998976306508738, 53.55627507425178], [9.99922637296961, 53.5561859455254],
                   [9.999512560141496, 53.55608801374537], [9.999837646540627, 53.55594221601244],
                   [10.000158102079372, 53.555790915947067], [10.000303511095503, 53.55572434374687],
                   [10.000488745510964, 53.555629712009338], [10.000677684614733, 53.55552517670439],
                   [10.000895335052896, 53.555410737758659], [10.001156515578693, 53.5552770418675],
                   [10.001288958185745, 53.55520551714323], [10.001616823101108, 53.55502230325949],
                   [10.00204286225666, 53.554802225473469], [10.0021678954871, 53.55473180034016],
                   [10.002418888120046, 53.554579395548838], [10.002491129542074, 53.55450016684839],
                   [10.002829182350287, 53.55427843573848], [10.003109812489708, 53.55408531414763],
                   [10.00324225509676, 53.554009935965598], [10.00333209378826, 53.55396591944681],
                   [10.00369469015652, 53.553834970032777], [10.003838246828503, 53.55373538218189],
                   [10.004242057854203, 53.55345422405615], [10.0046745802143, 53.55314060124205],
                   [10.004802391960969, 53.55305476722461], [10.004905197061549, 53.55298488940237],
                   [10.004991331064734, 53.55294087181728], [10.005052458421839, 53.552916662125998],
                   [10.005125626015945, 53.5528528365098], [10.005204350642512, 53.55275159567976],
                   [10.005227504944447, 53.55269767383446], [10.005252511590534, 53.55264210124851],
                   [10.005378470993043, 53.55232407059043], [10.005484980781932, 53.551991731501079],
                   [10.005510913600095, 53.55193945938687], [10.005544255794878, 53.551910297021418],
                   [10.005617423388984, 53.55167534666466], [10.0056391884328, 53.55160354073336],
                   [10.005735047242802, 53.5513817944444], [10.005804047062562, 53.551241482916918]],
    "3_Ost_West": [[10.006539890777973, 53.55060402253111], [10.006371327459903, 53.55103981867139],
                   [10.006239811024925, 53.55134465320297], [10.00611570396657, 53.55165608838085],
                   [10.006030496135456, 53.55178924547827], [10.005982335187437, 53.55190809608737],
                   [10.00597122112251, 53.55201924311416], [10.005945288304347, 53.552133691232729],
                   [10.005967516434203, 53.552215125282469], [10.005956402369272, 53.55227124865797],
                   [10.005821181245987, 53.552558467120238], [10.005754496856424, 53.5526619093073],
                   [10.005613718700675, 53.55273673966801], [10.005422927252753, 53.552926015871999],
                   [10.005102471714008, 53.553211029023739], [10.004809801337583, 53.55344872192154],
                   [10.004628271610433, 53.55361158480292], [10.004404137967727, 53.55380195751152],
                   [10.004242984026277, 53.55393290702773], [10.004209641831494, 53.553981325233618],
                   [10.004202232454875, 53.554026442148337], [10.003989212877097, 53.554249825188048],
                   [10.00389289098106, 53.55425642762449], [10.00375581751362, 53.55428503817046],
                   [10.00363911983188, 53.554340058396807], [10.003444623695648, 53.55445670104002],
                   [10.002940786085599, 53.554763711743238], [10.00273147119613, 53.55488255399803],
                   [10.002394344559996, 53.55506961983399], [10.002210962488692, 53.55516975473576],
                   [10.002123902313424, 53.55524348028118], [10.002042399170623, 53.55526658826151],
                   [10.001799742086368, 53.55529959964008], [10.001671930339703, 53.55535131741476],
                   [10.001425568567143, 53.55548886438016], [10.001294052132167, 53.55556699085741],
                   [10.001156978664728, 53.555641816080619], [10.000782805145498, 53.555820075638127],
                   [10.000479020704147, 53.55596642397267], [10.000145598756318, 53.55612157466181],
                   [9.999897384639603, 53.55623050991205], [9.999591747854096, 53.55634494664055],
                   [9.999228688399795, 53.55646488480264], [9.999080500867425, 53.556545210170629],
                   [9.998936018023369, 53.55659802676783], [9.998589629666459, 53.556665147764999],
                   [9.998258060062785, 53.55673667002185], [9.997687538063169, 53.556896219235998],
                   [9.996603916732733, 53.55717680432562], [9.995851865005968, 53.55735615774133],
                   [9.995285047694662, 53.5574771933591], [9.99475527726645, 53.55759272703482],
                   [9.99434776155244, 53.55767415057867], [9.994191238471375, 53.55770385912997],
                   [9.994084728682488, 53.55773741876471], [9.994036567734469, 53.55776052538294],
                   [9.993884675513792, 53.557747871760238], [9.993619790299683, 53.557801237012998],
                   [9.993315079686253, 53.55786065391628], [9.993166892153886, 53.557884860778859],
                   [9.993114100345482, 53.55789476358228], [9.992896449907317, 53.557897514360607],
                   [9.992654718995143, 53.55792997353128], [9.992328706423935, 53.55796573360571],
                   [9.99199528447611, 53.55801359704266], [9.991862841869052, 53.558035053048559],
                   [9.9915794332134, 53.55807741487438], [9.991362708947312, 53.55809997115393],
                   [9.991061703022194, 53.55814013230486], [9.9909024014249, 53.55815718702864],
                   [9.990419865772627, 53.5582287067632], [9.989886390656104, 53.558294724872428],
                   [9.989593720279676, 53.558337636588159], [9.989251962783149, 53.558355241381999],
                   [9.988749977517254, 53.55834973988471], [9.988618461082279, 53.55835634168137],
                   [9.988464716517445, 53.558379447961609], [9.98815907973194, 53.55835964257934],
                   [9.987866409355512, 53.55833103478856], [9.987605228829717, 53.55826061552884],
                   [9.986971727128847, 53.55822540585503], [9.986467889518793, 53.55818689524075],
                   [9.985930709713964, 53.558136281237249], [9.985334254896183, 53.55808456686675],
                   [9.984974900130192, 53.55804715643169], [9.984771142273188, 53.55800754534673],
                   [9.984534042221397, 53.55799104071707], [9.984359921870866, 53.55795858159324],
                   [9.984130231195696, 53.55791897042535], [9.983953332328934, 53.55789861467189],
                   [9.983839413163427, 53.557904116227827], [9.983777359634248, 53.55790741716108],
                   [9.98351988379676, 53.55783534672691], [9.983490246290286, 53.55779518528667],
                   [9.98340966931956, 53.55772586545081], [9.983360582199465, 53.55768790454019],
                   [9.983244810689805, 53.55765489502501], [9.982826180910866, 53.557498649637],
                   [9.982370504248838, 53.55733140041323], [9.981835176788158, 53.557092628994137],
                   [9.981448036859849, 53.55692097681878], [9.98102199770429, 53.556705310277937],
                   [9.980645971840906, 53.55649074298567], [9.980412576477429, 53.556362002088018],
                   [9.980095825626993, 53.556181544101928], [9.979810564627187, 53.556014289671498],
                   [9.979516041906605, 53.555843733485868], [9.979271532478198, 53.5556742769819],
                   [9.979117787913367, 53.55555213583409], [9.978956633971917, 53.555418990577617],
                   [9.97886957379665, 53.5553518676035], [9.978662111251336, 53.55520001523635],
                   [9.978569494043603, 53.555114185396458], [9.978489843244958, 53.55498213914893],
                   [9.978387964316456, 53.55487540146435], [9.978015643141382, 53.554569491969399],
                   [9.977504396154706, 53.55417994933933], [9.976607861583885, 53.553453673842707]]
}


def hausdorff_distance():
    for name in routes.keys():
        print(f"--- Route {name}---")
        for datasource in ["drn", "osm"]:
            print(f"{datasource}")
            routename = name
            file_name = f"../testroutes/map_matched/Strecke_{routename}_{datasource}_matched.json"
            with open(file_name) as f:
                content = json.load(f)

            coordinates_original = routes[routename]
            coordinates_map_matched = content["paths"][0]["points"]["coordinates"]

            project = partial(
                pyproj.transform,
                pyproj.Proj('EPSG:4326'),
                pyproj.Proj('EPSG:32633'),
                always_xy=True
            )
            ls_original = transform(project, LineString(coordinates_original))
            ls_map_matched = transform(project, LineString(coordinates_map_matched))

            hausdorff = ls_original.hausdorff_distance(ls_map_matched)
            print(f"Hausdorff: {hausdorff}m")

            coord_count = 0
            abs_dist = 0
            for coord in ls_original.coords:
                dist = ls_map_matched.distance(Point(coord))
                abs_dist += dist
                coord_count += 1
            avg_dist = abs_dist / coord_count
            print(f"average distance: {avg_dist}")


if __name__ == '__main__':
    hausdorff_distance()
